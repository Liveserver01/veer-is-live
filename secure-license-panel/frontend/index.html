<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>License Control Panel</title>
  <style>
    :root { --bg:#0b1220; --panel:#121a2b; --muted:#6b7a90; --text:#e9eefb; --accent:#4f8cff; --good:#2ecc71; --bad:#ff5c5c; }
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,Roboto,Arial;background:linear-gradient(180deg,#0b1220,#0d1424 30%,#0b1220);color:var(--text)}
    header{position:sticky;top:0;background:rgba(11,18,32,.8);backdrop-filter:blur(8px);border-bottom:1px solid #1d2a44;z-index:10}
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    h1{font-size:22px;margin:0 0 8px}
    .grid{display:grid;gap:16px}
    @media(min-width:860px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--panel);border:1px solid #1d2a44;border-radius:16px;box-shadow:0 10px 30px rgba(2,10,36,.25)}
    .card h2{margin:0 0 8px;font-size:18px}
    .card .body{padding:16px}
    label{display:block;font-size:12px;color:var(--muted);margin:10px 0 6px}
    input,select,button,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #243353;background:#0c1426;color:var(--text)}
    input:focus,textarea:focus,select:focus{outline:2px solid var(--accent);border-color:transparent}
    .row{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    .btn{cursor:pointer;border:none;background:linear-gradient(135deg,#4f8cff,#7aa9ff);color:#081022;font-weight:700}
    .btn.secondary{background:#101a31;border:1px solid #233457;color:#cfe0ff}
    .btn.danger{background:#2a1220;border:1px solid #52243a;color:#ffd5e0}
    .muted{color:var(--muted);font-size:12px}
    .status{margin-top:10px;padding:10px;border-radius:12px;background:#0d162b;border:1px dashed #2a3b66;font-family:monospace;white-space:pre-wrap;max-height:380px;overflow:auto}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:#0c1528;border:1px solid #22355d;font-size:12px}
    .flex{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .footer{opacity:.7;font-size:12px;margin-top:28px;text-align:center}
    #loginOverlay{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;align-items:center;justify-content:center;z-index:9999}
    #loginBox{background:var(--panel);padding:24px;border-radius:16px;width:320px;box-shadow:0 0 20px rgba(0,0,0,.6)}
    #loginBox h2{margin:0 0 12px;text-align:center}
    #loginBox input{margin-bottom:12px}
    #loginMsg{color:var(--bad);text-align:center;font-size:13px}
  </style>
</head>
<body>
  <!-- üîë Login Overlay -->
  <div id="loginOverlay">
    <div id="loginBox">
      <h2>Admin Login</h2>
      <input id="loginUser" placeholder="Username" />
      <input id="loginPass" type="password" placeholder="Password" />
      <button class="btn" id="loginBtn">Login</button>
      <p id="loginMsg"></p>
    </div>
  </div>

  <!-- Main Panel -->
  <div id="app" style="display:none">
    <header>
      <div class="wrap flex" style="justify-content:space-between">
        <div>
          <h1>üîê License Control Panel</h1>
          <div class="muted">Generate & verify keys with your backend</div>
        </div>
        <div class="pill" title="Environment">
          <span>API Base</span>
          <input id="baseUrl" style="width:300px" placeholder="https://veer-is-live.onrender.com/api" />
          <button class="btn secondary" id="logoutBtn">Logout</button>
        </div>
      </div>
    </header>

    <main class="wrap grid" style="margin-top:14px">
      <!-- Generate License -->
      <section class="card">
        <div class="body">
          <h2>üß™ Generate License</h2>
          <div class="muted">POST /license/generate</div>
          <div class="row">
            <div><label>Prefix</label><input id="genPrefix" placeholder="vip" /></div>
            <div><label>Device ID (optional)</label><input id="genDevice" placeholder="device-123" /></div>
          </div>
          <div class="row">
            <div><label>Days</label><input id="genDays" type="number" value="7" /></div>
            <div><label>Max Devices</label><input id="genMax" type="number" value="1" /></div>
          </div>
          <div class="flex" style="margin-top:12px">
            <button class="btn" id="genBtn">Generate</button>
            <button class="btn secondary" id="genClear">Clear</button>
          </div>
          <div id="genOut" class="status" style="display:none"></div>
          <div id="genKeyWrap" class="flex" style="margin-top:10px;display:none">
            <span class="muted">License Key:</span>
            <div class="pill"><code id="genKeyText">‚Äî</code>
              <button class="btn secondary" id="copyGen">Copy</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Verify License -->
      <section class="card">
        <div class="body">
          <h2>üîé Verify License</h2>
          <div class="muted">POST /verify</div>
          <label>License Key</label>
          <input id="verKey" placeholder="vip-XXXXXX..." />
          <label>Device ID</label>
          <input id="verDevice" placeholder="device-abc" />
          <div class="flex" style="margin-top:12px">
            <button class="btn" id="verBtn">Verify</button>
            <button class="btn secondary" id="verClear">Clear</button>
          </div>
          <div id="verOut" class="status" style="display:none"></div>
        </div>
      </section>

      <!-- Console -->
      <section class="card" style="grid-column:1 / -1">
        <div class="body">
          <h2>üìú Live Console</h2>
          <div id="console" class="status"></div>
        </div>
      </section>
    </main>

    <div class="footer wrap">Made for your backend ¬∑ Works on mobile üì±</div>
  </div>

<script>
  const $=id=>document.getElementById(id);
  const defaultBase='https://veer-is-live.onrender.com/api';
  const baseUrlInput=$('baseUrl');
  baseUrlInput.value=localStorage.getItem('apiBase')||defaultBase;
  baseUrlInput.addEventListener('change',()=>localStorage.setItem('apiBase',baseUrlInput.value.trim()));
  function api(path){
    const base = (baseUrlInput.value||defaultBase).replace(/\/+$/,'');
    const p = path.replace(/^\/+/,'');
    return `${base}/${p}`;
  }
  function log(msg){const c=$('console');if(c)c.textContent=`[${new Date().toLocaleTimeString()}] ${msg}\n${c.textContent||''}`;}
  function showJson(el,data){el.style.display='block';el.textContent=JSON.stringify(data,null,2);}

  // ---------- Auth ----------
  async function doLogin(){
    const username=$('loginUser').value.trim();
    const password=$('loginPass').value.trim();
    try{
      log(`Login attempt for ${username}`);
      const res = await fetch(api('/auth/login'),{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({username,password})
      });
      const data = await res.json();
      if(data.success && data.token){
        localStorage.setItem('token',data.token);
        $('loginOverlay').style.display='none';
        $('app').style.display='block';
        log('Login successful ‚úî');
      } else {
        $('loginMsg').textContent = data.message || 'Invalid login';
        log('Login failed ‚ùå');
      }
    }catch(e){
      $('loginMsg').textContent='Error: '+e.message;
      log('Login error ‚ùå '+e.message);
    }
  }
  $('loginBtn').addEventListener('click',doLogin);
  $('logoutBtn').addEventListener('click',()=>{
    localStorage.removeItem('token');
    $('app').style.display='none';
    $('loginOverlay').style.display='flex';
    log('Logged out');
  });

  if(localStorage.getItem('token')){
    $('loginOverlay').style.display='none';
    $('app').style.display='block';
  }

  // ---------- Generate License ----------
  $('genBtn').addEventListener('click',async()=>{
    const body={prefix:$('genPrefix').value.trim(),days:parseInt($('genDays').value),maxDevices:parseInt($('genMax').value)};
    if($('genDevice').value.trim())body.deviceId=$('genDevice').value.trim();
    try{
      log('POST '+api('/license/generate'));
      const res=await fetch(api('/license/generate'),{
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization':'Bearer '+localStorage.getItem('token')
        },
        body:JSON.stringify(body)
      });
      const data=await res.json();
      showJson($('genOut'),data);
      if(data.key||data.licenseKey){$('genKeyText').textContent=data.key||data.licenseKey;$('genKeyWrap').style.display='flex';}
    }catch(e){showJson($('genOut'),{error:true,message:e.message});}
  });
  $('genClear').addEventListener('click',()=>{$('genPrefix').value='';$('genDevice').value='';$('genDays').value=7;$('genMax').value=1;$('genOut').style.display='none';$('genKeyWrap').style.display='none';});
  $('copyGen').addEventListener('click',async()=>{const txt=$('genKeyText').textContent.trim();if(txt){await navigator.clipboard.writeText(txt);log('Key copied');}});

  // ---------- Verify License ----------
  $('verBtn').addEventListener('click',async()=>{
    try{
      const res=await fetch(api('/verify'),{
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization':'Bearer '+localStorage.getItem('token')
        },
        body:JSON.stringify({key:$('verKey').value.trim(),deviceId:$('verDevice').value.trim()})
      });
      const data=await res.json();
      showJson($('verOut'),data);
      log('Verify request done');
    }catch(e){showJson($('verOut'),{error:true,message:e.message});}
  });
  $('verClear').addEventListener('click',()=>{$('verKey').value='';$('verDevice').value='';$('verOut').style.display='none';});
</script>
</body>
  </html>
